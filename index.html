<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AFilm — Дело «Цифровая Память»</title>
<meta name="description" content="Детективная история о любительском кино. Собери улики с разных цифровых камер и раскрой тайну исчезновения." />
<style>
  :root{
    --bg:#1b1b1b; --bg-2:#222; --bg-3:#2a2a2a;
    --txt:#f0f0f0; --muted:#bdbdbd; --accent:#F6A155; --accent-2:#ffbd7a;
    --danger:#e85b5b; --ok:#47c47c;
    --radius:16px; --radius-lg:22px;
  }
  *,*:before,*:after{box-sizing:border-box}
  html{scroll-behavior:smooth}
  html,body{margin:0;background:var(--bg);color:var(--txt);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  a{color:var(--accent);text-decoration:none}
  header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,rgba(0,0,0,.65),rgba(0,0,0,.25));backdrop-filter:saturate(1.2) blur(6px);border-bottom:1px solid #000}
  .wrap{max-width:1100px;margin:0 auto;padding:18px 20px}
  .row{display:flex;gap:16px;flex-wrap:wrap}
  .brand{font-weight:800;font-size:22px;letter-spacing:.3px}
  .nav{margin-left:auto;display:flex;gap:14px;align-items:center}
  .nav a{padding:8px 12px;border-radius:10px;transition:.15s}
  .nav a:hover{background:var(--bg-3)}
  .hero{padding:52px 20px 28px}
  h1{font-size:56px;margin:0 0 8px}
  h2{font-size:32px;margin:32px 0 8px}
  p.lead{color:var(--muted);max-width:780px;margin:0 0 20px}
  .btn{appearance:none;border:0;background:var(--accent);color:#24170a;padding:12px 18px;border-radius:14px;font-weight:700;cursor:pointer;transition:.15s transform,.2s background}
  .btn:hover:not(:disabled){background:var(--accent-2);transform:translateY(-1px)}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn.secondary{background:var(--bg-3);color:var(--txt)}
  .btn.ghost{background:transparent;border:1px solid var(--bg-3);color:var(--txt)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:18px}
  .card{background:var(--bg-3);border:1px solid #000;border-radius:var(--radius);padding:16px;position:relative;overflow:hidden;transition:.2s}
  .card:hover{border-color:#333}
  .card h3{margin:6px 0 6px;font-size:18px}
  .badge{display:inline-block;padding:4px 8px;border-radius:10px;background:#333;color:#ddd;font-size:12px;margin-right:6px}
  .camera-icon{width:72px;height:46px;border-radius:10px;background:var(--accent);opacity:.85}
  .sub{color:var(--muted);font-size:14px}
  .cta{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
  .muted{color:var(--muted)}
  .pill{font-size:12px;border:1px solid #333;padding:4px 8px;border-radius:999px;color:#ddd;transition:.2s}
  .pill.active{background:var(--ok);color:#000;border-color:var(--ok)}
  .panel{background:var(--bg-2);border:1px solid #000;border-radius:var(--radius-lg);padding:16px}
  .progress{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .kpi{background:#151515;border:1px solid #000;border-radius:12px;padding:10px 12px}
  .kpi strong{font-size:18px}
  .sep{height:1px;background:#000;margin:22px 0}
  
  /* toast */
  .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#000;border:1px solid #333;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:.2s;z-index:100}
  .toast.show{opacity:1}
  
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;padding:20px;z-index:90}
  .modal.show{display:flex}
  .modal__inner{max-width:640px;width:100%;background:var(--bg-2);border:1px solid #000;border-radius:18px;overflow:hidden;animation:modalIn .2s ease-out}
  @keyframes modalIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
  .modal__head{padding:14px 16px;background:#161616;border-bottom:1px solid #000;display:flex;gap:10px;align-items:center}
  .modal__body{padding:16px}
  .close{margin-left:auto;background:#2a2a2a;border:1px solid #000;color:#fff;border-radius:10px;padding:6px 10px;cursor:pointer;transition:.15s}
  .close:hover{background:#333}
  
  /* floating */
  .float{position:fixed;right:18px;bottom:18px;z-index:40;display:flex;flex-direction:column;gap:10px}
  .fab{width:48px;height:48px;border-radius:14px;border:1px solid #000;background:#2b2b2b;color:#fff;cursor:pointer;display:grid;place-items:center;transition:.15s;text-decoration:none}
  .fab:hover{background:#333;transform:translateY(-2px)}
  
  /* poster */
  #posterWrap{width:100%;max-width:520px}
  .center{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
  small.code{font-family:ui-monospace,Menlo,Consolas,monospace;color:#bbb}
  .hint{font-size:14px;color:#bbb}
  
  /* responsive */
  @media (max-width:700px){ 
    h1{font-size:40px} 
    .nav{display:none}
    .hero{padding:40px 20px 20px}
  }
</style>
</head>
<body>
<header>
  <div class="wrap row">
    <div class="brand">AFilm</div>
    <nav class="nav">
      <a href="#investigation">Игра</a>
      <a href="#cameras">База камер</a>
      <a href="#about">О проекте</a>
    </nav>
  </div>
</header>

<main>
  <section class="wrap hero">
    <h1>Дело «Цифровая Память»</h1>
    <p class="lead">Детективная история о любительской киностудии. Сопоставляйте улики,
      снятые на разные цифровые камеры, чтобы раскрыть «исчезновение» второго режиссёра.
      Проводник — говорящая камера <b>Пикси</b>.</p>
    <div class="row">
      <a class="btn" href="#investigation">Начать расследование</a>
      <a class="btn secondary" href="#cameras">База знаний о камерах</a>
    </div>
  </section>

  <section id="investigation" class="wrap">
    <h2>Расследование</h2>
    <p class="muted">Соберите минимум <b>3 улики</b>, чтобы открыть финал. «Запутанность» — часть игры: если потерялись, жмите кнопку <b>?</b> (Пикси подскажет).</p>

    <div class="panel">
      <div class="progress">
        <div class="kpi"><div class="muted">Улик собрано</div><strong><span id="clueCount">0</span>/4</strong></div>
        <div class="kpi"><div class="muted">Статус финала</div><strong id="finalState">закрыт</strong></div>
        <button class="btn ghost" id="goFinal">Перейти к финалу</button>
        <button class="btn ghost" id="reset">Сбросить прогресс</button>
      </div>
    </div>

    <div class="sep"></div>

    <div class="grid" id="actsGrid"></div>
  </section>

  <section id="final" class="wrap" style="margin-top:40px">
    <h2>Финал — Постер дела</h2>
    <p class="muted">Когда собраны ≥3 улики, Пикси сгенерирует памятный постер на основе выбранных фрагментов. Его можно сохранить и отправить в чат.</p>
    <div class="center">
      <div id="posterWrap"></div>
      <div>
        <div class="panel" style="max-width:520px">
          <p><b>Выбранные улики:</b></p>
          <ul id="chosenList" class="muted" style="margin-top:6px"></ul>
          <div class="cta">
            <button id="buildPoster" class="btn">Сформировать постер</button>
            <button id="savePoster" class="btn secondary">Скачать PNG</button>
          </div>
          <p class="hint">Подпись: «Команда инсценировала исчезновение, чтобы добиться разговора о выгорании».</p>
        </div>
      </div>
    </div>
  </section>

  <section id="cameras" class="wrap" style="margin-top:44px">
    <h2>База камер</h2>
    <p class="muted">Мини-справочник — стилизованные «кадры» под эпоху. Реальные фото не обязательны: стиль считывается по обработке.</p>
    <div class="grid" id="camGrid"></div>
  </section>

  <section id="about" class="wrap" style="margin:44px 0 60px">
    <h2>О проекте</h2>
    <p>Игра сделана командой <b>AFilm</b> как интерактивная иллюстрация к курсу о цифровых камерах
      и устройстве любительских киностудий. В этой версии всё работает без сборок и зависимостей —
      обычный <code>index.html</code> на GitHub Pages / Netlify Drop.</p>
    <p class="muted">v1.1 — «Улучшенное издание». Рефакторинг кода, фикс багов UX, SVG-постер.</p>
    <p><small class="code">Если что-то «ломается» — это нарочно: запутанность как часть сюжета. Но Пикси всегда рядом.</small></p>
  </section>
</main>

<!-- MODAL -->
<div class="modal" id="modal" role="dialog" aria-labelledby="mTitle" aria-modal="true">
  <div class="modal__inner">
    <div class="modal__head">
      <div class="camera-icon" id="mIcon" style="margin-right:10px"></div>
      <div>
        <div id="mTitle" style="font-weight:800"></div>
        <div id="mSub" class="muted" style="font-size:13px"></div>
      </div>
      <button class="close" id="mClose" aria-label="Закрыть">Закрыть</button>
    </div>
    <div class="modal__body">
      <p id="mText" class="muted"></p>
      <div class="cta">
        <button class="btn" id="mAdd">Добавить улику</button>
        <button class="btn secondary" id="mNext">Подсказка Пикси</button>
      </div>
    </div>
  </div>
</div>

<!-- FLOAT -->
<div class="float">
  <button id="help" class="fab" aria-label="Подсказка Пикси">?</button>
  <a href="#investigation" class="fab" aria-label="К делу">↑</a>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
'use strict';

/* ---------- КОНФИГУРАЦИЯ ---------- */
const CONFIG = {
  VERSION: '1.1',
  MIN_CLUES: 3,
  IDLE_HINT_DELAY: 20000, // 20 секунд
  STORAGE_KEY: 'afilm_state',
  
  ACTS: [
    {
      id:'act1', camera:'TRV900', badge:'Акт I — Ввод в дело',
      clueId:'trv900', clueTitle:'Спор в 10:53', 
      clueText:'Старая Sony TRV900 фиксирует на заднем плане жёсткий спор Фокина с продюсером. Тёплая картинка и 4:3 — «как память», но звук ловит всплески эмоций.',
      summary:'Оценка студии. Появляется Пикси.'
    },
    {
      id:'act2', camera:'XL1', badge:'Акт II — След через камеры',
      clueId:'xl1', clueTitle:'Силуэт у подсобки', 
      clueText:'На Canon XL1 в 10:57 — силуэты у подсобки: Фокин и женщина (Светлана). Модульная камера, нейтральная «документальная» картинка.',
      summary:'TRV900: спор. XL1: силуэт в подсобке.'
    },
    {
      id:'act3', camera:'DVX100', badge:'Акт III — Узкий круг',
      clueId:'dvx100', clueTitle:'Перемещения в 11:04', 
      clueText:'DVX100 (легендарные 24p) на штативе: в кадр по очереди заходят Фокин и фигура в худи. Камера не шевелится — улики читаются чётко.',
      summary:'DVX100 фиксирует перемещения.'
    },
    {
      id:'act4', camera:'HC1', badge:'Акт IV — Документы плана',
      clueId:'hc1', clueTitle:'Встреча в подсобке', 
      clueText:'Анна на Sony HC1 (1080i) снимает «совещание»: обсуждают инсценировку, чтобы остановить выгорание и заставить режиссёра услышать команду.',
      summary:'HC1: интервью раскрывают постановку.'
    }
  ],
  
  CAMERAS: [
    {name:'Sony DCR-TRV900', year:1998, tag:'Ранняя цифровая', look:'тёплый, мягкий 4:3', id:'TRV900'},
    {name:'Canon XL1', year:1998, tag:'Полупроф', look:'нейтральный, сменная оптика', id:'XL1'},
    {name:'Panasonic AG-DVX100', year:2002, tag:'Проф', look:'24p, CineGamma', id:'DVX100'},
    {name:'Sony DCR-HC1', year:2004, tag:'Handycam', look:'1080i, rolling-shutter', id:'HC1'},
    {name:'Canon Vixia HF G10', year:2010, tag:'AVCHD', look:'FullHD, сочные цвета', id:'HFG10'},
    {name:'GoPro Hero3', year:2012, tag:'Экшн', look:'рыбий глаз, 170°', id:'GOPRO'}
  ],
  
  CLUE_TITLES: {
    trv900: ['TRV900', 'Спор в 10:53'],
    xl1: ['XL1', 'Силуэт у подсобки'],
    dvx100: ['DVX100', 'Перемещения в 11:04'],
    hc1: ['HC1', 'Встреча: план инсценировки']
  }
};

/* ---------- УТИЛИТЫ ---------- */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

function toast(msg, duration = 2500) {
  const t = $('#toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toast._timer);
  toast._timer = setTimeout(() => t.classList.remove('show'), duration);
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

/* ---------- СОСТОЯНИЕ ---------- */
class GameState {
  constructor() {
    this.clues = new Set();
    this.version = CONFIG.VERSION;
    this.load();
  }
  
  load() {
    try {
      const stored = localStorage.getItem(CONFIG.STORAGE_KEY);
      if (!stored) return;
      
      const data = JSON.parse(stored);
      
      // Миграция старых версий
      if (!data.version || data.version < CONFIG.VERSION) {
        console.log('Migrating from old version');
        this.clues = new Set(data.clues || data || []);
      } else {
        this.clues = new Set(data.clues || []);
      }
    } catch (e) {
      console.error('Failed to load state:', e);
      this.reset();
    }
  }
  
  save() {
    try {
      localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify({
        version: this.version,
        clues: [...this.clues]
      }));
    } catch (e) {
      console.error('Failed to save state:', e);
      toast('Ошибка сохранения прогресса');
    }
  }
  
  addClue(id) {
    if (this.clues.has(id)) return false;
    this.clues.add(id);
    this.save();
    return true;
  }
  
  hasClue(id) {
    return this.clues.has(id);
  }
  
  getCount() {
    return this.clues.size;
  }
  
  isFinaleUnlocked() {
    return this.clues.size >= CONFIG.MIN_CLUES;
  }
  
  reset() {
    this.clues.clear();
    this.save();
  }
  
  getClues() {
    return [...this.clues];
  }
}

const state = new GameState();

/* ---------- РЕНДЕРИНГ ---------- */
function renderActs() {
  const grid = $('#actsGrid');
  grid.innerHTML = CONFIG.ACTS.map(act => `
    <article class="card">
      <span class="badge">${escapeHtml(act.badge)}</span>
      <div class="row" style="gap:12px;align-items:center;margin-top:8px">
        <div class="camera-icon"></div>
        <div style="flex:1">
          <h3>${escapeHtml(act.camera)}: улика «${escapeHtml(act.clueTitle)}»</h3>
          <div class="sub">${escapeHtml(act.summary)}</div>
        </div>
      </div>
      <div class="cta">
        <button class="btn" data-act="${act.id}">Смотреть фрагмент</button>
        <span class="pill ${state.hasClue(act.clueId) ? 'active' : ''}" data-pill="${act.clueId}">
          ${state.hasClue(act.clueId) ? 'Добавлено' : 'Ещё не в деле'}
        </span>
      </div>
    </article>
  `).join('');
  
  // Навесить обработчики
  grid.querySelectorAll('[data-act]').forEach(btn => {
    btn.addEventListener('click', () => openModal(btn.dataset.act));
  });
}

function renderCameras() {
  const grid = $('#camGrid');
  grid.innerHTML = CONFIG.CAMERAS.map(cam => `
    <article class="card">
      <div class="row" style="gap:12px;align-items:center">
        <div class="camera-icon"></div>
        <div style="flex:1">
          <h3>${escapeHtml(cam.name)}</h3>
          <div class="sub">${escapeHtml(cam.tag)} • ${cam.year}</div>
          <div class="muted" style="margin-top:6px">Стиль: ${escapeHtml(cam.look)}</div>
        </div>
      </div>
    </article>
  `).join('');
}

function updateProgress() {
  $('#clueCount').textContent = state.getCount();
  $('#finalState').textContent = state.isFinaleUnlocked() ? 'открыт' : 'закрыт';
  $('#buildPoster').disabled = !state.isFinaleUnlocked();
  $('#savePoster').disabled = !state.isFinaleUnlocked();
  
  // Обновить таблетки
  $$('[data-pill]').forEach(pill => {
    const id = pill.dataset.pill;
    const active = state.hasClue(id);
    pill.classList.toggle('active', active);
    pill.textContent = active ? 'Добавлено' : 'Ещё не в деле';
  });
}

function renderChosenList() {
  const list = $('#chosenList');
  const clues = state.getClues();
  
  if (clues.length === 0) {
    list.innerHTML = '<li class="muted">Пока пусто…</li>';
    return;
  }
  
  list.innerHTML = clues
    .map(id => {
      const [camera, note] = CONFIG.CLUE_TITLES[id] || ['?', '?'];
      return `<li>${escapeHtml(camera)} — ${escapeHtml(note)}</li>`;
    })
    .join('');
}

/* ---------- МОДАЛЬНОЕ ОКНО ---------- */
let currentAct = null;
const modal = $('#modal');
const modalInner = $('.modal__inner');

function openModal(actId) {
  const act = CONFIG.ACTS.find(a => a.id === actId);
  if (!act) return;
  
  currentAct = act;
  
  $('#mTitle').textContent = `${act.badge} / ${act.camera}`;
  $('#mSub').textContent = `Улика: «${act.clueTitle}»`;
  $('#mText').textContent = act.clueText;
  
  const hasClue = state.hasClue(act.clueId);
  $('#mAdd').textContent = hasClue ? 'Улика уже в деле' : 'Добавить улику';
  $('#mAdd').disabled = hasClue;
  
  modal.classList.add('show');
  
  // Фокус на первую кнопку
  setTimeout(() => $('#mAdd').focus(), 100);
}

function closeModal() {
  modal.classList.remove('show');
  currentAct = null;
}

// Обработчики модала
$('#mClose').addEventListener('click', closeModal);
modal.addEventListener('click', e => {
  if (e.target === modal) closeModal();
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape' && modal.classList.contains('show')) {
    closeModal();
  }
});

$('#mAdd').addEventListener('click', () => {
  if (!currentAct) return;
  
  const added = state.addClue(currentAct.clueId);
  if (added) {
    toast(`Улика добавлена (${state.getCount()}/${CONFIG.ACTS.length})`);
    updateProgress();
    renderChosenList();
    closeModal();
  } else {
    toast('Эта улика уже в деле');
  }
});

$('#mNext').addEventListener('click', () => {
  const hints = [
    'Пикси: сопоставь TRV900 (10:53) и XL1 (10:57) — там временная связка',
    'Пикси: DVX100 (11:04) покажет движения — обрати внимание на фигуру в худи',
    'Пикси: HC1 содержит ключевое интервью — там раскрывается план',
    'Пикси: улики нужно собрать все, но достаточно трёх для финала'
  ];
  toast(hints[Math.floor(Math.random() * hints.length)], 3500);
});

/* ---------- ФИНАЛ ---------- */
$('#goFinal').addEventListener('click', () => {
  if (state.isFinaleUnlocked()) {
    $('#final').scrollIntoView({ behavior: 'smooth', block: 'start' });
  } else {
    const need = CONFIG.MIN_CLUES - state.getCount();
    toast(`Нужно ещё ${need} улика(и) → изучите Акты I–IV`);
  }
});

$('#reset').addEventListener('click', () => {
  if (!confirm('Сбросить весь прогресс? Это действие нельзя отменить.')) return;
  
  state.reset();
  updateProgress();
  renderActs();
  renderChosenList();
  toast('Прогресс сброшен');
});

/* ---------- ПОСТЕР (SVG вместо Canvas) ---------- */
function createPoster() {
  const clues = state.getClues().slice(0, 3);
  const W = 1080, H = 1600;
  
  const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}" viewBox="0 0 ${W} ${H}">
  <defs>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&amp;display=swap');
      text { font-family: 'Inter', system-ui, sans-serif; }
    </style>
  </defs>
  
  <rect width="${W}" height="${H}" fill="#1e1e1e"/>
  
  <!-- Заголовок -->
  <text x="80" y="150" font-size="92" font-weight="800" fill="#ffffff">AFilm</text>
  <text x="80" y="210" font-size="40" font-weight="600" fill="#ffffff">Дело «Цифровая Память»</text>
  
  <!-- Карточки улик -->
  ${clues.map((id, i) => {
    const [camera, note] = CONFIG.CLUE_TITLES[id] || ['?', '?'];
    const y = 300 + i * 400;
    return `
      <g>
        <rect x="80" y="${y}" width="920" height="360" rx="24" fill="#262626"/>
        <rect x="110" y="${y + 70}" width="240" height="150" rx="14" fill="#F6A155"/>
        <text x="380" y="${y + 130}" font-size="56" font-weight="700" fill="#ffffff">${escapeHtml(camera)}</text>
        <text x="380" y="${y + 180}" font-size="32" fill="#dddddd">${escapeHtml(note)}</text>
      </g>
    `;
  }).join('')}
  
  <!-- Подпись -->
  <text x="80" y="1460" font-size="26" fill="#cfcfcf">
    Команда инсценировала исчезновение,
  </text>
  <text x="80" y="1495" font-size="26" fill="#cfcfcf">
    чтобы добиться разговора о выгорании.
  </text>
  <text x="80" y="1540" font-size="24" font-weight="500" fill="#a0a0a0">
    AFilm • game poster • v${CONFIG.VERSION}
  </text>
</svg>`;
  
  return svg;
}

function displayPoster() {
  const wrap = $('#posterWrap');
  const svg = createPoster();
  wrap.innerHTML = svg;
  wrap.querySelector('svg').style.cssText = 'width:100%;height:auto;border:1px solid #000;border-radius:16px;background:#111';
}

$('#buildPoster').addEventListener('click', () => {
  if (!state.isFinaleUnlocked()) {
    toast(`Нужно ещё ${CONFIG.MIN_CLUES - state.getCount()} улика(и)`);
    return;
  }
  
  displayPoster();
  renderChosenList();
  toast('Постер обновлён');
});

$('#savePoster').addEventListener('click', () => {
  if (!state.isFinaleUnlocked()) {
    toast('Сначала соберите улики');
    return;
  }
  
  const svg = createPoster();
  const blob = new Blob([svg], { type: 'image/svg+xml' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.download = 'AFilm_poster.svg';
  a.href = url;
  a.click();
  
  URL.revokeObjectURL(url);
  toast('Постер сохранён как SVG');
});

/* ---------- ПИКСИ: ПОДСКАЗКИ ---------- */
let idleTimer = null;
let lastInteraction = Date.now();

function scheduleHint() {
  clearTimeout(idleTimer);
  lastInteraction = Date.now();
  
  idleTimer = setTimeout(() => {
    // Проверяем, что пользователь действительно неактивен
    if (Date.now() - lastInteraction < CONFIG.IDLE_HINT_DELAY) return;
    
    const missing = CONFIG.ACTS
      .map(a => a.clueId)
      .filter(id => !state.hasClue(id));
    
    if (missing.length === 0) {
      toast('Пикси: все улики собраны — добро пожаловать в финал!', 3000);
    } else {
      const next = missing[0].toUpperCase();
      toast(`Пикси: если запутался — глянь ${next} и сравни время с другими уликами`, 3500);
    }
  }, CONFIG.IDLE_HINT_DELAY);
}

// Отслеживать только значимые действия
['click', 'keydown'].forEach(e => {
  document.addEventListener(e, scheduleHint);
});

$('#help').addEventListener('click', e => {
  e.stopPropagation();
  toast('Пикси: сопоставь TRV900 (10:53) и XL1 (10:57), затем DVX100 (11:04) — там временная последовательность', 4000);
});

/* ---------- ИНИЦИАЛИЗАЦИЯ ---------- */
function init() {
  renderActs();
  renderCameras();
  updateProgress();
  renderChosenList();
  
  if (state.isFinaleUnlocked()) {
    displayPoster();
  }
  
  scheduleHint();
  
  console.log(`AFilm v${CONFIG.VERSION} initialized. Clues: ${state.getCount()}/${CONFIG.ACTS.length}`);
}

// Запуск после загрузки DOM
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>
</body>
</html>
